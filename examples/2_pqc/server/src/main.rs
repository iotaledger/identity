// Copyright 2024 Fondazione Links
// SPDX-License-Identifier: Apache-2.0

use warp::Filter;

const CERT_PEM: &str = r#"
-----BEGIN CERTIFICATE-----
MIIFfTCCA2WgAwIBAgIUKRmy+fJlEoA6QuOV9cDgjapPtHIwDQYJKoZIhvcNAQEL
BQAwTjELMAkGA1UEBhMCSVQxEzARBgNVBAgMClNvbWUtU3RhdGUxFjAUBgNVBAoM
DUlzc3VlciBTZXJ2ZXIxEjAQBgNVBAMMCWxvY2FsaG9zdDAeFw0yNDA1MzAxNzEy
MjhaFw0yNTA1MzAxNzEyMjhaME4xCzAJBgNVBAYTAklUMRMwEQYDVQQIDApTb21l
LVN0YXRlMRYwFAYDVQQKDA1Jc3N1ZXIgU2VydmVyMRIwEAYDVQQDDAlsb2NhbGhv
c3QwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQC0NgJZ4NAx0/Aho4/A
y+eq8XC8n8DUvQQ7kPpbHBzo0m3EFJS2I9cZg3m4UjZsDeX5hy+6hyA2cMTwY2rG
X4tz1FK+ObiM4MFgj0oI6UC9SrLrUdBP3dazdLEKbAjgLLgJwKMQKiPn8DNx+/Jw
pH9OhmqEiK3mOBjifKr9ib7rvRBfgar7xzyv+oLgjs9jR9KU2QO+jw15bp/8+aI8
q3yIGkxP5lp/tmo1JzBEwfEgGz5X3LY+h5Z9EjQZPH1ZWp2WV6epk4WZVKMeSTEe
Rmv0ztG2Ib42GkIX4Ne1TNKWt/mHGwrfXCDkBk+PDqsMCvVk2ZoRPpriOU/1+dWv
Nbt69wqIxDMG+EvdlCEoOdFPJt+Wk0kO+k0MDHmXtEkyUNnRNds1yQ/+6/WuuZ+1
+UPOs51QA/uSnhh9t2ZrpyVQYfAb6dlKYtB82aXwF0AF2yNVearmZuXqqm15EwBe
Ra3lFfbrQ1EfC1biaLrXaa6AR+xhNyTlJbjiN3hVUV9Z/0vLWMKfuKBWEB0rgEPp
3opTxyZj1MQQu5EkCABHu68yDPwRazd4pGsjcnwDTLC7JMp33vZCvOTkIL09yW4v
Dh6Um5vRtlB9UnoyT8h6+rvPzH6rnX+CURDgOFS4GP2jj+9KxtDdfwopZXYsEK9e
P0kYIszhaHhn5KE8bQOeafpWXwIDAQABo1MwUTAdBgNVHQ4EFgQUevGkLEz/xQ3q
cN/N9+5qLbLZfrMwHwYDVR0jBBgwFoAUevGkLEz/xQ3qcN/N9+5qLbLZfrMwDwYD
VR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAgEAhoa+2JoI0RX5uB4w2Lxz
q1XrIMShU5lj9PwyrwSAHR1A6UkPefnMk9aLybJhCgakfttgTETGChZoOQZdyn53
QzZf66z2e6nzrQgMRiv3DqEPOtXb9CnbXWMeHGV2B7M0OOIvwQLabzzryT1RawJz
NIu8q8bEyo95/fdVtV/OPFP8/4LTiqGJCfQ4avH62NUFmxjVO9RpU2ULCSeAHWHG
5g8On/hTeI9eWugqkjH7UrSFm/aDQH0Qf+glnUZBFPHYd38oQQd0PvBYnlKccw6r
uzU1ekgM/bQl8C3BcXt/zFlT1Dtp6EY1pz5sKjEBMDjfWxnLGNhDbCYG7+w3ki/w
zTZjLyOh9R4rzXSTPACki8CcCz6rZqPCm5AIyPnPspeSgYLAIgHjrWKsUiX9Gl6m
D03Wk8YJLabRiz16l7FK/RN+vNlX8URuWZYOcdxHVz8ZU6tD+VAWh9vS+LS5a/1E
Hw3JobssPUA7ZsF9PYRpNv9RckMPbAnct9tmA9s6NUOuxzFfcNf13DGwkUBImqF3
e38wWAchOydQ0vghbiCpMOwD6IrssQBTQMRYOlrol6osrRxuXJvb15dpUkq64Q6/
gfi1O7mVEkNhDjpv8ebBLqy8qnQZmOc+h7JMPI7fHsFLTenJqKjawx6C3WVp/B0J
K/HioaQNxyYc+7hW1bWvwIU=
-----END CERTIFICATE-----
"#;

const KEY_PEM: &str = r#"
-----BEGIN PRIVATE KEY-----
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
DcdbW3ZurxzQIr/OYo8xwUOR9USF
-----END PRIVATE KEY-----
"#;


#[tokio::main]
async fn main() {
    const PORT: u16 = 4443;
    println!("Server is listening on port {} ...", PORT);

    // Match any request and return hello world!
    let route = warp::path(".well-known")
    .and(warp::fs::dir("./.well-known"));

    warp::serve(route)
        .tls()
        .cert(CERT_PEM.as_bytes())
        .key(KEY_PEM.as_bytes())
        .run(([127, 0, 0, 1], PORT))
        .await;

}